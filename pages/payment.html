<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/ticket.css">
    <link href='https://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'>
    <style>
        /* Эстетичный стиль */
        #pay {
            font-family: 'Lora', serif;
            background-color: #f7f7f7;
            color: #333;
            margin: 0;
            padding: 0;
        }

        #pay.container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: dimgray;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        #pay h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        #pay form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #pay label {
            font-size: 1.1em;
            font-weight: bold;
            color: black;
        }

        #pay input {
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #pay button {
            background-color: #aa9b82;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
        }

        #pay button:hover {
            background-color: #887d69;
        }

        #pay error-message {
            color: red;
            font-size: 0.9em;
            margin-top: -10px;
        }

        #pay h2 {
            color: black;
        }

        #expiry-date {
            max-width: 97%;
            background-color: #fff;
        }

        #visit-date {
            background-color: #fff;
            max-width: 97%;
        }
    </style>
</head>
<body>
<header class="header">
    <!-- Текст "основан в XXXX году" -->
    <div class="since">Founded in 1793</div>

    <!-- Название "Louvre" по центру -->
    <div class="logo">
        <a href="../index.html"><h1>Louvre</h1></a>
    </div>

    <!-- Контактный номер телефона -->

    <a href="tel:33 1 40 20 50 50">
        <div class="contact">+33 1 40 20 50 50</div>
    </a>
</header>

<!-- Меню навигации -->
<nav class="menu">
    <a href="exhibitions.html">Exhibitions</a>
    <a href="schedule.html">Schedule</a>
    <a href="tickets-info.html">Buy Tickets</a>

</nav>


<div id="xs-deliver" class="text-center visible-xs"></div>

<div id="pay" class="container">
    <h2>Payment Details</h2>
    <form id="payment-form">
        <label for="card-name">Cardholder Name:</label>
        <input type="text" id="card-name" name="card-name" placeholder="Enter cardholder name" required>

        <label for="card-number">Card Number:</label>
        <input type="text" id="card-number" name="card-number" placeholder="1234 5678 9012 3456" required maxlength="16">

        <label for="expiry-date">Expiry Date:</label>
        <input type="date" id="expiry-date" name="expiry-date" required>

        <label for="cvv">CVV:</label>
        <input type="text" id="cvv" name="cvv" placeholder="123" required maxlength="3">

        <label for="visit-date">Visit Date:</label>
        <input type="date" id="visit-date" name="visit-date" required>
        <div class="error-message" id="date-error" style="display: none;">You cannot select a past date!</div>

        <button type="submit" class="submit-button">Submit Payment</button>
    </form>
</div>

<footer class="panel-footer">
    <p>&copy; Louvre Museum 2024</p>
</footer>

<!-- JavaScript -->
<script>
    // Получение элементов
    const form = document.getElementById('payment-form');
    const visitDate = document.getElementById('visit-date');
    const dateError = document.getElementById('date-error');
    const expiryDate = document.getElementById('expiry-date');

    // Установка минимальной даты (сегодня)
    const today = new Date().toISOString().split('T')[0];
    visitDate.min = today;

    // Обработка отправки формы
    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Отключаем стандартное поведение

        const cardNumber = document.getElementById('card-number').value.replace(/\s+/g, '');
        const cvv = document.getElementById('cvv').value;
        const selectedDate = new Date(visitDate.value);
        const now = new Date();
        const cardHolder = document.getElementById('card-name').value;
        const expiry = new Date(expiryDate.value);


        // Проверка номера карты (16 цифр)
        if (!/^\d{16}$/.test(cardNumber)) {
            alert('Please enter a valid 16-digit card number.');
            return;
        }

        // Проверка CVV (3 цифры)
        if (!/^\d{3}$/.test(cvv)) {
            alert('Please enter a valid 3-digit CVV.');
            return;
        }

        if (expiry < now) {
            alert('Your card has expired. Please use a valid card.');
            return;
        }

        // Проверка даты посещения
        if (selectedDate < now) {
            dateError.style.display = 'block';
            return;
        } else {
            dateError.style.display = 'none';
        }

        // Сохранение данных покупки в JSON
        const ticketData = {
            cardHolder: document.getElementById('card-name').value,
            cardNumber: cardNumber.replace(/\d{12}(\d{4})/, '************$1'),
            visitDate: visitDate.value,
            ticketType: "Adult Ticket", // Здесь можно добавить выбор типа
            price: "22€" // Также изменить на динамический
        };

        // Сохранение в localStorage
        localStorage.setItem('ticketData', JSON.stringify(ticketData));
        localStorage.setItem('cardName', document.getElementById('card-name').value);
        localStorage.setItem('cardNumber', cardNumber.replace(/\d{12}(\d{4})/, '************$1'));
        localStorage.setItem('ticketType', "Adult Ticket"); // Здесь можно сделать выбор типа билета динамическим
        localStorage.setItem('price', "22€"); // Также изменить на динамический
        localStorage.setItem('visitDate', visitDate.value);


        // Перенаправление на страницу чека
        window.location.href = 'receipt.html';


    });
</script>
</body>
</html>
